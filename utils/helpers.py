import os
import shutil
import tempfile

    
def saveTemp(file, folder_name="temp"):
    
    # Generate a temporary file name
    tmp_file_name = next(tempfile._get_candidate_names())
    tmp_dir = os.path.join(folder_name, tmp_file_name)
    # Create the folder if it doesn't exist
    if not os.path.exists(tmp_dir):
        os.makedirs(tmp_dir)

    

    # Create a temporary file in the specified folder with the generated name
    tmp_file_path = os.path.join(tmp_dir, file.name)
    with open(tmp_file_path, "wb") as tmp_file:
        tmp_file.write(file.getvalue())

    return {
        "file":tmp_file_path,
        "dir":tmp_dir,
        "name":tmp_file_name
    }

def get_file_names(directory_path):
    if not os.path.exists(directory_path):
        return None

    file_paths = []

    for root, _, files in os.walk(directory_path):
        if len(files) == 1:
            file_paths.append(os.path.join(root, files[0]))
        else:
            file_paths.extend([os.path.join(root, file) for file in files])
    if len(file_paths) == 1:
        return file_paths[0]
    if len(file_paths) == 0:
        return None
    return file_paths

def annotate(annotated,arguments):
    colors = ["#faf","#aff","#ffa","#faa","#afa"]
    annotations = ''
    annotations+=f'annotation("{",".join(arguments)}",background="{colors[0]}",fontSize="14px",marginRight="5px"),'
    for i,text in enumerate(annotated):
         annotations += f'annotation("{text}",background="{colors[i+1]}",fontSize="14px",marginRight="5px"),'
    return f'annotated_text({annotations})'
   
def remove_dir(path):
    try:
        shutil.rmtree(path)
    except Exception as e:
        pass

def reset_dataset_directory():
    remove_dir('dataset/process')
    os.makedirs('dataset/process/input/tables')
    os.makedirs('dataset/process/input/images')
    os.makedirs('dataset/process/input/vector')
    os.makedirs('dataset/process/output/tables')
    os.makedirs('dataset/process/output/images')
    os.makedirs('dataset/process/output/vector')